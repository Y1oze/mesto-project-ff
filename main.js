(()=>{"use strict";var e="https://nomoreparties.co/v1/wff-cohort-26/",t="ff84996d-926f-4ee1-ab5f-bc0b66b93768";function n(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}function o(o,r){return fetch("".concat(e,"cards"),{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(o),link:"".concat(r),length:0})}).then((function(e){return n(e)}))}var r,c=document.querySelector("#card-template").content;function a(e,t,n,o,r){var a=c.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__delete-button"),u=a.querySelector(".card__image"),s=a.querySelector(".card__like-button"),l=a.querySelector(".card__like-numbers");return a.querySelector(".card__title").textContent=e.name,u.src=e.link,u.alt=e.name,l.textContent=e.likes.length,e.owner._id===r&&(i.classList.remove("card__delete-button-hidden"),i.addEventListener("click",(function(){t(e._id,a)}))),e.likes.forEach((function(e){e._id===r&&s.classList.add("card__like-button_is-active")})),s.addEventListener("click",(function(){n(e._id,s,l)})),u.addEventListener("click",o),a}function i(e){r=e,e.classList.add("popup_is-opened"),e.addEventListener("click",u),document.addEventListener("keydown",s)}function u(e){e.target===e.currentTarget&&l()}function s(e){"Escape"===e.key&&r&&l()}function l(){r&&(r.classList.remove("popup_is-opened"),r.removeEventListener("click",u),document.removeEventListener("keydown",s),r=void 0)}function d(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent="",t.setCustomValidity("")}function p(e,t){var n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,c=t.inputErrorClass,a=t.errorClass,i=Array.from(e.querySelectorAll(n)),u=e.querySelector(o);i.forEach((function(t){d(e,t,c,a)})),m(i,u,r)}function f(e,t){e.disabled=!0,e.classList.add(t)}function m(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.disabled=!1,e.classList.remove(t)}(t,n):f(t,n)}var _,v,h,y,S,b,E,C,q=document.querySelector(".places__list"),L=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-button"),g=document.querySelector(".avatar__edit-button"),x=document.querySelector(".popup_type_edit"),T=document.querySelector(".popup_type_new-card"),A=document.querySelector(".popup_type_image"),j=document.querySelector(".popup_delete-card"),w=document.querySelector(".popup_new-avatar"),z=x.querySelector(".popup__close"),D=T.querySelector(".popup__close"),B=A.querySelector(".popup__close"),P=(j.querySelector(".popup__close"),w.querySelector(".popup__close")),N=document.querySelector(".popup__image"),O=document.querySelector(".popup__caption"),J=document.forms["edit-profile"],M=document.forms["new-place"],V=document.forms["confirm-delete"],G=document.forms["new-avatar"],H=document.querySelector(".popup__input_type_name"),U=document.querySelector(".popup__input_type_description"),F=M.elements["place-name"],I=M.elements.link,K=G.elements.avatar,Q=document.querySelector(".profile__title"),R=document.querySelector(".profile__description"),W=document.querySelector(".profile__image"),X={},Y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function Z(e){var t=document.querySelector(".popup_is-opened").querySelector(".popup__button");e?(f(t,"popup__button_disabled"),t.textContent="Сохранение..."):t.textContent="Сохранить"}function $(e){N.src=e.srcElement.currentSrc,N.alt=e.srcElement.alt,O.textContent=e.srcElement.alt,i(A)}function ee(e,t){X={id:e,cardElement:t},i(j)}function te(o,r,c){r.classList.contains("card__like-button_is-active")?function(o){return fetch("".concat(e,"cards/likes/").concat(o),{method:"DELETE",headers:{authorization:t,"Content-Type":"application/json"}}).then((function(e){return n(e)}))}(o).then((function(e){c.textContent=e.likes.length,r.classList.remove("card__like-button_is-active")})).catch((function(e){return console.error(e)})):function(o){return fetch("".concat(e,"cards/likes/").concat(o),{method:"PUT",headers:{authorization:t,"Content-Type":"application/json"}}).then((function(e){return n(e)}))}(o).then((function(e){c.textContent=e.likes.length,r.classList.add("card__like-button_is-active")})).catch((function(e){return console.error(e)}))}!function(o,r,c){fetch("".concat(e,"users/me"),{method:"GET",headers:{authorization:t}}).then((function(e){return n(e)})).then((function(e){_=e._id,o.textContent=e.name,r.textContent=e.about,c.setAttribute("style","background-image: url(".concat(e.avatar,");"))}))}(Q,R,W),h=(v=Y).formSelector,y=v.inputSelector,S=v.submitButtonSelector,b=v.inactiveButtonClass,E=v.inputErrorClass,C=v.errorClass,Array.from(document.querySelectorAll(h)).forEach((function(e){!function(e,t,n,o,r,c){var a=Array.from(e.querySelectorAll(t)),i=e.querySelector(n);m(a,i,o),a.forEach((function(t){t.addEventListener("input",(function(){m(a,i,o),function(e,t,n,o){t.validity.valid?d(e,t,n,o):(t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o))}(e,t,r,c)}))}))}(e,y,S,b,E,C)})),fetch("".concat(e,"cards"),{method:"GET",headers:{authorization:t}}).then((function(e){return n(e)})).then((function(e){e.forEach((function(e){q.append(a(e,ee,te,$,_))}))})),x.classList.add("popup_is-animated"),T.classList.add("popup_is-animated"),A.classList.add("popup_is-animated"),J.addEventListener("submit",(function(e){e.preventDefault(),Q.textContent=H.value,R.textContent=U.value})),M.addEventListener("submit",(function(e){e.preventDefault();var t={name:F.value,link:I.value};o(t.name,t.link).then((function(e){q.prepend(a(e,ee,te,$)),l()})),M.reset()})),L.addEventListener("click",(function(){H.value=Q.textContent,U.value=R.textContent,i(x),p(J,Y),H&&U?(H.value=Q.textContent,U.value=R.textContent):console.error("Поля ввода не найдены. Проверьте селекторы.")})),k.addEventListener("click",(function(){i(T),p(M,Y)})),g.addEventListener("click",(function(e){i(w),p(G,Y)})),[z,D,B,P].forEach((function(e){e.addEventListener("click",l)})),J.addEventListener("submit",(function(o){var r,c;o.preventDefault(),Z(!0),(r=H.value,c=U.value,fetch("".concat(e,"users/me"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(r),about:"".concat(c)})}).then((function(e){return n(e)}))).then((function(){Q.textContent=H.value,R.textContent=U.value})).then((function(){Z(!1),l()})).catch((function(e){return console.error(e)}))})),M.addEventListener("submit",(function(e){e.preventDefault(),Z(!0),o(F.value,I.value).then((function(e){q.prepend(a(e,ee,te,$,_))})).then((function(){Z(!1),l()})).catch((function(e){return console.error(e)}))})),V.addEventListener("submit",(function(o){var r;o.preventDefault(),(r=X.id,fetch("".concat(e,"cards/").concat(r),{method:"DELETE",headers:{authorization:t,"Content-Type":"application/json"}}).then((function(e){return n(e)}))).then((function(){X.cardElement.remove(),l(),X={}})).catch((function(e){return console.error(e)}))})),G.addEventListener("submit",(function(o){var r;o.preventDefault(),Z(!0),(r=K.value,fetch("".concat(e,"users/me/avatar"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(r)})}).then((function(e){return n(e)}))).then((function(e){W.setAttribute("style","background-image: url(".concat(e.avatar,");"))})).then((function(){Z(!1),l()})).catch((function(e){return console.error(e)}))}))})();